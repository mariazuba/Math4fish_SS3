---
title: "Visualización de Resultados"
date: '`r format(Sys.Date(),"Última actualización: %B, %d, %Y")`'
---



```{css,echo=FALSE}


.scroll-200{
            max-height: 200px; 
            overflow-y: auto; 
            background-color: #f1f1f1;
            }
```



```{css,echo=FALSE}

/*----------LOGO above TOC---------*/

#TOC::before {
  content: "";
  display: block;
  height: 100px;
  margin: 2em 20px 40px 20px;
  background-image: url("LOGO_2SN_recortado.png");
  background-size: contain;
  background-position: center center;
  background-repeat: no-repeat;
}

```



```{r global-options, include=FALSE}
knitr::opts_chunk$set(eval=T,echo=T, warning=FALSE, message=FALSE,class.output="scroll-200",fig.align = "center")
```


# Visualizando resultados de SS3 
```{r}
#install.packages('r4ss') 
#install.packages('here')
```

## Directorios de trabajo

 Cargar librería `here()`
 
```{r}

library(here)
here()
dir(here())

```
 

 Luego, identificar el directorio  donde están los archivos del modelo 
```{r}
dir(here("modelos_SS3"))
mod_path <- here("modelos_SS3","simple")
```

Revisamos que esten todos los archivos de entrada

```{r}
dir(mod_path)

```

Creamos un nuevo directorio en la carpeta `Ejercicios` para ejecutar los ejemplos

```{r}
dirname.visualizar <- here("Ejercicios","2_Visualizacion_SS3")
dir.create(path=dirname.visualizar, showWarnings = TRUE, recursive = TRUE)
dirname.visualizar

dir(dirname.visualizar)
```


```{r echo=FALSE,eval=F}
unlink(dirname.visualizar, recursive = TRUE)
```

Copiamos  los archivos del directorio donde están los archivos del modelo SS3  en la carpeta donde ejecutaremos el ejercicio 

```{r}
file.copy(Sys.glob(paste(mod_path, "*.*", sep="/"),
                   dirmark = FALSE),
                   dirname.visualizar)

```



Luego, identificamos el directorio  donde está el archivo ejecutable (`ss.exe`)
```{r}
exe_path <- here("Ejecutables_SS3","3.30.19_release")
ss_exe   <- paste(exe_path,"ss_win.exe",sep= "/")
```

Cargamos la librería `r4ss`

```{r}
library(r4ss)
```


## Ejecutamos el modelo SS3 

Ejecutamos el modelo con la función `system()`

```{r}
r4ss::run_SS_models(dirvec=dirname.visualizar, 
                    model=ss_exe,
                    skipfinished=FALSE)
```


## Leer las salidas

Leemos la salida del modelo SS3  con la función `SS_output()`
```{r}
replist <- SS_output(dir=dirname.visualizar,verbose=TRUE,printstats=TRUE)

```



## Visualización 

Generamos los Plots y html con la función `SS_plots()`

```{r}
#?SS_plots
SS_plots(replist)

```



También podemos Crear plots individuales de interés, por ejemplo ...


```{r eval=F}
SSplotData(replist, subplot = 1)
```



Biología
```{r}
sspar(mfrow = c(3, 2), plot.cex = 0.7)
SSplotBiology(replist, subplot = c(1,5,6,10,11))
```



 Matriz edad-talla
```{r}
sspar(mfrow = c(4, 2), plot.cex = 0.5)
SSplotAgeMatrix(replist)
```



 Selectividad
```{r}
SSplotSelex(replist,subplot =1)
SSplotSelex(replist,subplot =2)
```


 Series de tiempo
```{r}
#?SSplotTimeseries
sspar(mfrow = c(4, 2), plot.cex = 0.6)
SSplotTimeseries(replist,subplot =1)
SSplotTimeseries(replist,subplot =3)
SSplotTimeseries(replist,subplot =4)
SSplotTimeseries(replist,subplot =6)
SSplotTimeseries(replist,subplot =7)
SSplotTimeseries(replist,subplot =9)
SSplotTimeseries(replist,subplot =10)
SSplotTimeseries(replist,subplot =11)
```


 Relación stock-recluta
```{r}
sspar(mfrow = c(1, 2), plot.cex = 0.8)
SSplotSpawnrecruit(replist,subplot =2:3,legend = T)
```


 Yield
```{r}
sspar(mfrow = c(2, 2), plot.cex = 0.6)
SSplotYield(replist)
```

 Capturas
```{r}
SSplotCatch(replist, subplots =c(2,9, 10))
```



 Índices
```{r}
sspar(mfrow = c(2, 2), plot.cex = 0.6)
SSplotIndices(replist, subplots = c(9,2,7))
```


 Ajustes y residuos
```{r}

SSplotComps(replist, subplots = c(21,24))
```

 Composición de tallas
```{r}
SSplotComps(replist, subplots = c(1:1))
```

 Mortalidad por pesca
```{r}
SSplotSummaryF(replist)
```

 Proporción sexual
```{r}
SSplotSexRatio(replist)
```

 Curva SRP
```{r}
sspar(mfrow = c(2, 2), plot.cex = 0.6)
SSplotSPR(replist)
```


 Desvíos de reclutamiento
```{r}
SSplotRecdevs(replist)
```

Parámetros estimados
```{r}
SSplotPars(replist)

SSplotNumbers(replist)

sspar(mfrow = c(2, 1), plot.cex = 0.6)
SSplotCohortCatch(replist)

sspar(mfrow = c(3, 2), plot.cex = 0.6)
SSplotIndices(replist)

sspar(mfrow = c(1, 1), plot.cex = 0.6)
SSplotDynamicB0(replist)
```




